## shell 功能命令

### 代码行数查看

```sh

    $ find ./ -name "*.c"  | xargs wc -l | sort -n

```

搜索 *.c, *.h, *.cc 三类文件

``` sh

    $ find . \( -name "*.h" -o -name "*.c" -o -name "*.cc" \) -print | xargs wc -l 

```

## ps 打印指定进程的线程信息

```sh

    ps -mp pid -o THREAD,tid,time

```

## screen 使用

```sh

    screen -S <name>        # Ctrl+a, Ctrl+d detach from screen
    screen -D -r <name>     # Attach screen

    screen -S <name> -L     # Create a screen with output logging

```

## shell debug use set

```sh

    set -x      # activate debugging from here
    set +x      # stop debugging from here
    
    set -e      # When set, the shell exits when a simple command in a command list exits non-zero (FALSE). This is not done in situations, where the exit code is already checked (if, while, until, ||, &&)
    set -o errexit # Same as -e

```

Using ‘+’ rather than ‘-’ causes these options to be turned off.

https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html

## cut, awk, xargs

```sh

    function col {
      awk -v col=$1 '{print $col}'
    }

    function skip {
        n=$(($1 + 1))
        cut -d' ' -f$n-
    }

    root@SZX1000044380:/opt# docker images | col 3
    IMAGE
    a5a467fddcb8
    b79b8abd1f91
    c5dc6967e168

    root@SZX1000044380:/opt# docker images | col 3 | xargs 
    IMAGE a5a467fddcb8 b79b8abd1f91 c5dc6967e168

    root@SZX1000044380:/opt# docker images | col 3 | xargs | skip 1
    a5a467fddcb8 b79b8abd1f91 c5dc6967e168

```

## grep

```sh

    grep -v "^#" /etc/squid3/squid.conf | grep -v "^$"

    find -name '*.go' | grep -v 'test.go' | grep -v Godeps | xargs wc -l

```

## head cmd

```sh

    container_id=$(docker ps -a | grep opnfv/functest | awk '{print $1}' | head -1)

```

## curl 断点续传

```sh

    curl -C - -O URL

    root@SZX1000044380:/opt/compass4nfv# curl -C - -O http://58.251.166.184:9999/centos7-juno-ppa.tar.gz
    ** Resuming transfer from byte position 331776
      % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                     Dload  Upload   Total   Spent    Left  Speed
      0  382M    0 3857k    0     0   306k      0  0:21:17  0:00:12  0:21:05  372k
    root@SZX1000044380:/opt/compass4nfv# curl -C - -O http://58.251.166.184:9999/centos7-juno-ppa.tar.gz
    ** Resuming transfer from byte position 4395008
      % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                     Dload  Upload   Total   Spent    Left  Speed
      0  378M    0 1827k    0     0   580k      0  0:11:08  0:00:03  0:11:05  579k

```

## sed 文本全局替换

```sh

    cat test 
    abc eee bcd eee sfsdf ddd

    sed -i 's/eee/bbb/g' test 

    cat test 
    abc bbb bcd bbb sfsdf ddd

```

## ssh 远程命令执行

```sh

    root@SZX1000044380:/opt/compass4nfv# uname -a
    Linux SZX1000044380 3.13.0-24-generic #47-Ubuntu SMP Fri May 2 23:30:00 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
    root@SZX1000044380:/opt/compass4nfv# ssh 10.229.43.154 "uname -a"
    root@10.229.43.154's password: 
    Linux SZX1000044381 3.13.0-24-generic #47-Ubuntu SMP Fri May 2 23:30:00 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux

```

## 获取 bash 脚本的当前目录

SCRIPT_DIR=`cd ${BASH_SOURCE[0]%/*};pwd`

root@SZX1000044381:~/abc# cat main.sh
#!/bin/bash

SCRIPT_DIR=`cd ${BASH_SOURCE[0]%/*};pwd`
echo $SCRIPT_DIR

source sub/sub.sh

root@SZX1000044381:~/abc# cat sub/sub.sh
#!/bin/bash

SCRIPT_DIR=`cd ${BASH_SOURCE[0]%/*};pwd`
echo $SCRIPT_DIR

root@SZX1000044381:~/abc# ./main.sh
/root/abc
/root/abc/sub

## dirname/basename

dirname /root/yardstick/ci/run.sh
basname /root/yardstick/ci/run.sh

## bash 变量可以被 export 导出的环境变量覆盖

: ${BOTTLENECKS_DB_TARGET:='http://213.77.62.197/results'}

